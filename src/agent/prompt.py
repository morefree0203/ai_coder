# Prompt 模板集中管理，方便后续多 Agent 共享

SYSTEM_RESEARCH_BASE = """你是一名资深的 Research AI 助手，目标：
1. 理解用户研究意图，拆分为可执行子问题
2. 利用可用工具（搜索/检索/MCP工具）收集可靠信息
3. 综合多来源，标注引用来源，输出结构化总结
4. 支持用户的质疑与迭代调整（保持上下文连贯）

约束：
- 如果信息不确定，明确说明不确定性
- 优先中文回答（除非用户要求英文）
- 提供清晰的推理步骤（不要暴露模型内部 token）
"""

PLAN_PROMPT = """基于用户的目标或问题："{query}"
请生成一个分步研究计划：
- 列出关键子问题（最多 {max_subquestions} 条）
- 每个子问题附上用途说明
- 如果当前上下文已有答案的部分，标记为(已有上下文)
输出 JSON 数组，例如：
[
  {{ "subq": "...", "reason": "..." }},
  ...
]
"""

SYNTHESIS_PROMPT = """你已获得以下原始搜索片段（可能不完整，有噪声）：
----------------
{snippets}
----------------
用户原始问题：{query}

请：
1. 综合关键信息
2. 去除重复
3. 标记不确定或冲突的地方
4. 引用来源，用 [#编号] 对应 snippet 索引（从1开始）
5. 给出后续可能的深挖方向

输出结构化 Markdown：
# 总结
...
# 关键点
- ...
# 来源引用
- [#1] ...
# 风险与不确定
- ...
# 进一步研究建议
- ...
"""

CRITIQUE_PROMPT = """用户对上一轮回答的反馈/质疑是：
"{feedback}"

请基于已有总结，判断：
1. 哪些点需要修正或补充
2. 是否需要新增搜索
3. 给出改进后的回答（保持原结构）

如果需要新增搜索，请列出新的子问题列表（JSON），否则返回空列表。
格式：
{{ 
  "need_new_search": true/false,
  "new_subquestions": [ "..." ],
  "improved_answer": "Markdown文本" 
}}
"""

MEMORY_SUMMARIZE_PROMPT = """以下是过往多轮对话（包含用户与AI），请压缩为：
1. 用户的总体研究目标
2. 已确认的事实
3. 悬而未决的问题
4. 风格 / 偏好（如果有）

保持尽可能信息量，但减少冗余。

历史：
{history}
"""